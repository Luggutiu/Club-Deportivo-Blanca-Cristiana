{% extends "base_public.html" %}

{% block title %}Inicio - Club Deportivo Blanca Cristiana{% endblock %}

{% block content %}
<div class="publicaciones-wrapper">

  <!-- Buscador -->
  <div style="margin-bottom: 20px;">
    <label for="busqueda" style="color:#ffb3c6; font-weight:bold;">üîç Buscar:</label><br>
    <input type="text" id="busqueda" placeholder="Escribe una palabra clave..." style="width: 100%; padding: 10px; border-radius: 10px; border: 1px solid #ff5e78; background-color: #1c1c1c; color: #fff;">
  </div>

  <!-- √öLTIMAS PUBLICACIONES -->
  <h2>üì£ √öltimas Publicaciones y Horarios</h2>

  <div id="publicaciones-container">

    <div style="color: yellow;">
      <h3>DEBUG: Mostrando tipos de publicaciones</h3>
      <ul>
        {% for item in publicaciones %}
          <li>{{ item.__class__.__name__ }}</li>
        {% endfor %}
      </ul>
    </div>

    {% for item in publicaciones %}
      {% if item.__class__.__name__ == "Horario" %}
        <!-- Horario publicado -->
        <div class="horario-box" style="background-color:#222; padding:15px; border-radius:10px; margin-bottom:20px; border-left: 5px solid #25d366;">
          <h3 style="color:#25d366;">üóìÔ∏è {{ item.dia }}</h3>
          <p style="color:white;">üïê {{ item.hora_inicio }} - {{ item.hora_fin }}</p>
          <p style="color:white;">üèÉ Actividad: {{ item.actividad }}</p>
        </div>
      {% else %}
        <!-- Publicaci√≥n (post/video/texto) -->
        <div class="post" data-plataforma="{{ item.plataforma or 'Texto' }}" data-id="{{ item.id }}">
          {% if item.titulo %}
            <h3 style="color:#ffb3c6;">{{ item.titulo }}</h3>
          {% endif %}
          {% if item.texto %}
            <p style="color:white;">{{ item.texto }}</p>
          {% endif %}
          {% if item.imagen_url %}
            <img src="{{ item.imagen_url }}" alt="Imagen del post" style="max-width:100%; border-radius: 8px; margin:10px 0;">
          {% elif item.imagen_archivo %}
            <img src="/static/uploads/{{ item.imagen_archivo }}" alt="Imagen subida" style="max-width:100%; border-radius: 8px; margin:10px 0;">
          {% endif %}

          {% if item.video_embed %}
            <div class="video-embed-container">
              {{ item.video_embed | safe }}
            </div>
          {% elif item.plataforma in ["YouTube", "Facebook", "TikTok", "Instagram"] %}
            <div class="video-embed-container">
              <iframe src="{{ item.embed_url }}"
                      allowfullscreen
                      loading="lazy"
                      title="Publicaci√≥n en {{ item.plataforma }}"></iframe>
            </div>
          {% elif item.plataforma == "Twitter" %}
            <blockquote class="twitter-tweet">
              <a href="{{ item.url }}"></a>
            </blockquote>
          {% endif %}

          <div class="plataforma">Plataforma: {{ item.plataforma or 'Texto' }}</div>

          <div class="acciones-post" style="margin-top: 10px; display: flex; justify-content: space-between; align-items: center;">
            <div class="likes" id="likes-{{ item.id }}" style="color: #fff;">
              ‚ù§Ô∏è {{ item.likes or 0 }} Me gusta
            </div>
            <button onclick="darLike('{{ item.id }}')"
                    style="background-color: #ff5e78; color: white; border: none; padding: 6px 12px; border-radius: 8px; cursor: pointer;">
              ‚ù§Ô∏è Me gusta
            </button>
          </div>
        </div>
      {% endif %}
    {% else %}
      <p style="color: #ccc;">No hay publicaciones disponibles.</p>
    {% endfor %}

  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .publicaciones-wrapper {
    padding: 20px;
  }

  h2 {
    color: #ff91a4;
    margin-top: 30px;
    margin-bottom: 20px;
    border-left: 5px solid #ff5e78;
    padding-left: 15px;
  }

  .post {
    background-color: rgba(255, 255, 255, 0.05);
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: 0 0 10px rgba(255, 65, 180, 0.3);
  }

  .horario-box {
    background-color: rgba(0, 255, 0, 0.05);
    padding: 20px;
    border-radius: 15px;
    margin-bottom: 30px;
    border: 1px solid #25d366;
    box-shadow: 0 0 10px rgba(0, 255, 0, 0.2);
  }

  .plataforma {
    margin-top: 10px;
    color: #ffb3c6;
    font-size: 0.9em;
    text-align: right;
  }

  img {
    max-width: 100%;
    height: auto;
    display: block;
  }

  .video-embed-container {
    position: relative;
    width: 100%;
    padding-top: 75%;
    border-radius: 8px;
    overflow: hidden;
    margin-top: 10px;
    background-color: #000;
  }

  .video-embed-container iframe,
  .video-embed-container .video-embed {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  function darLike(postId) {
    fetch(`/like/${postId}`, {
      method: 'POST'
    })
    .then(response => {
      if (response.ok) return response.json();
      throw new Error("Error al dar like");
    })
    .then(data => {
      const likesDiv = document.getElementById(`likes-${postId}`);
      if (likesDiv) {
        likesDiv.innerText = `‚ù§Ô∏è ${data.likes} Me gusta`;
      }
    })
    .catch(error => console.error("Error al dar like:", error));
  }
</script>
{% endblock %}