{% extends "base_public.html" %}

{% block title %}Inicio - Club Deportivo Blanca Cristiana{% endblock %}

{% block content %}
<div class="publicaciones-wrapper">

  <!-- Buscador -->
  <div class="buscador">
    <label for="busqueda" class="label-busqueda">üîç Buscar:</label><br>
    <input type="text" id="busqueda" placeholder="Escribe una palabra clave..." class="input-busqueda">
  </div>

  <!-- √öltimas publicaciones -->
  <h2>üì£ √öltimas Publicaciones</h2>

  <div id="publicaciones-container">

    <div class="debug-tipos">
      <ul>
        {% for item in publicaciones %}
          <li>{{ item.__class__.__name__ }}</li>
        {% endfor %}
      </ul>
    </div>

    {% for item in posts %}
      <div class="post" data-plataforma="{{ item.plataforma or 'Texto' }}" data-id="{{ item.id }}">

        {% if item.titulo %}
          <h3 class="titulo-post">{{ item.titulo }}</h3>
        {% endif %}

        {% if item.texto %}
          <p class="texto-post">{{ item.texto }}</p>
        {% endif %}

        {% if item.imagen_url %}
          <img src="{{ item.imagen_url }}" alt="Imagen del post" class="imagen-post">
        {% elif item.imagen_archivo %}
          <img src="/static/uploads/{{ item.imagen_archivo }}" alt="Imagen subida" class="imagen-post">
        {% endif %}

        {% if item.video_embed %}
          <div class="video-embed-container">
            {{ item.video_embed | safe }}
          </div>
        {% elif item.plataforma in ["YouTube", "Facebook", "TikTok", "Instagram"] %}
          <div class="video-embed-container">
            <iframe src="{{ item.embed_url }}" allowfullscreen loading="lazy" title="Publicaci√≥n en {{ item.plataforma }}"></iframe>
          </div>
        {% elif item.plataforma == "Twitter" %}
          <blockquote class="twitter-tweet">
            <a href="{{ item.url }}"></a>
          </blockquote>
        {% endif %}

        <div class="plataforma">Plataforma: {{ item.plataforma or 'Texto' }}</div>

        <div class="acciones-post">
          <div class="likes" id="likes-{{ item.id }}">
            ‚ù§Ô∏è {{ item.likes or 0 }} Me gusta
          </div>
          <button onclick="darLike('{{ item.id }}')" class="btn-like">
            ‚ù§Ô∏è Me gusta
          </button>
        </div>
      </div>
    {% else %}
      <p class="no-publicaciones">No hay publicaciones disponibles.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  function darLike(postId) {
    fetch(`/like/${postId}`, {
      method: 'POST'
    })
    .then(response => {
      if (response.ok) return response.json();
      throw new Error("Error al dar like");
    })
    .then(data => {
      const likesDiv = document.getElementById(`likes-${postId}`);
      if (likesDiv) {
        likesDiv.innerText = `‚ù§Ô∏è ${data.likes} Me gusta`;
      }
    })
    .catch(error => console.error("Error al dar like:", error));
  }
</script>
{% endblock %}